---
title: Google Vertex AI
description: Learn how to use the Google Vertex AI provider.
---

# Google Vertex Provider

The Google Vertex provider for the [AI SDK](https://sdk.vercel.ai/docs) contains language model support for the [Google Vertex AI](https://cloud.google.com/vertex-ai) APIs.

## Setup

The Google provider is available in the `@ai-sdk/google-vertex` module. You can install it with

<Tabs items={['pnpm', 'npm', 'yarn']}>
  <Tab>
    <Snippet text="pnpm add @ai-sdk/google-vertex" dark />
  </Tab>
  <Tab>
    <Snippet text="npm install @ai-sdk/google-vertex" dark />
  </Tab>
  <Tab>
    <Snippet
      text="yarn add @ai-sdk/google-vertex @google-cloud/vertexai"
      dark
    />
  </Tab>
</Tabs>

## Provider Instance

To get started, import `createVertex` from `@ai-sdk/google-vertex` and create a provider instance with your settings. The Google Vertex provider supports two different authentication methods depending on your runtime environment.

### Node.js Runtime

The Node.js runtime supports all standard Google Cloud authentication options through the [`google-auth-library`](https://github.com/googleapis/google-auth-library-nodejs?tab=readme-ov-file#ways-to-authenticate). Typical use involves setting a path to a json credentials file in the `GOOGLE_APPLICATION_CREDENTIALS` environment variable. The credentials file can be obtained from the Google Cloud Console.

To create a provider instance, import `createVertex` and `generateAuthToken` from `@ai-sdk/google-vertex/auth-google` and pass the `Authorization` header with the `Bearer` token to the `createVertex` function:

```ts
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-google';

const vertex = createVertex({
  headers: async () => ({
    Authorization: `Bearer ${await generateAuthToken()}`,
  }),
  project: 'my-project', // optional
  location: 'us-central1', // optional
});
```

If you want to customize the google authentication options, you can pass them as an options argument to `generateAuthToken`.

```ts
const token = await generateAuthToken({
  scopes: ['https://www.googleapis.com/auth/cloud-platform'],
});
```

The following options are available for the `googleAuthOptions` argument:

- **googleAuthOptions** _object_

  Optional. The Authentication options used by the [Google Auth Library](https://github.com/googleapis/google-auth-library-nodejs/). See also the [GoogleAuthOptions](https://github.com/googleapis/google-auth-library-nodejs/blob/08978822e1b7b5961f0e355df51d738e012be392/src/auth/googleauth.ts#L87C18-L87C35) interface.

  - **authClient** _object_
    An `AuthClient` to use.

  - **keyFilename** _string_
    Path to a .json, .pem, or .p12 key file.

  - **keyFile** _string_
    Path to a .json, .pem, or .p12 key file.

  - **credentials** _object_
    Object containing client_email and private_key properties, or the external account client options.

  - **clientOptions** _object_
    Options object passed to the constructor of the client.

  - **scopes** _string | string[]_
    Required scopes for the desired API request.

  - **projectId** _string_
    Your project ID.

  - **universeDomain** _string_
    The default service domain for a given Cloud universe.

#### Optional Provider Settings

You can use the following optional settings to customize the provider instance:

- **project** _string_

  The Google Cloud project ID that you want to use for the API calls.
  It uses the `GOOGLE_VERTEX_PROJECT` environment variable by default.

- **location** _string_

  The Google Cloud location that you want to use for the API calls, e.g. `us-central1`.
  It uses the `GOOGLE_VERTEX_LOCATION` environment variable by default.

- **headers** _ResolvableHeaders_

  Headers to include in the requests. Can be provided in multiple formats:

  - A record of header key-value pairs: `Record<string, string | undefined>`
  - A function that returns headers: `() => Record<string, string | undefined>`
  - An async function that returns headers: `async () => Record<string, string | undefined>`
  - A promise that resolves to headers: `Promise<Record<string, string | undefined>>`

- **fetch** _(input: RequestInfo, init?: RequestInit) => Promise&lt;Response&gt;_

  Custom [fetch](https://developer.mozilla.org/en-US/docs/Web/API/fetch) implementation.
  Defaults to the global `fetch` function.
  You can use it as a middleware to intercept requests,
  or to provide a custom fetch implementation for e.g. testing.

### Edge Runtime

The Edge runtime supports Google's [Application Default Credentials](https://github.com/googleapis/google-auth-library-nodejs?tab=readme-ov-file#application-default-credentials) through environment variables. The values can be obtained from a json credentials file obtained from the Google Cloud Console.

To create a provider instance, import `createVertex` and `generateAuthToken` from `@ai-sdk/google-vertex/auth-edge` and pass the `Authorization` header with the `Bearer` token to the `createVertex` function:

```ts
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-edge';

const vertex = createVertex({
  headers: async () => ({
    Authorization: `Bearer ${await generateAuthToken()}`,
  }),
  project: 'my-project', // optional
  location: 'us-central1', // optional
});
```

#### Optional Provider Settings

You can use the following optional settings to customize the provider instance:

- **project** _string_

  The Google Cloud project ID that you want to use for the API calls.
  It uses the `GOOGLE_VERTEX_PROJECT` environment variable by default.

- **location** _string_

  The Google Cloud location that you want to use for the API calls, e.g. `us-central1`.
  It uses the `GOOGLE_VERTEX_LOCATION` environment variable by default.

- **headers** _ResolvableHeaders_

  Headers to include in the requests. Can be provided in multiple formats:

  - A record of header key-value pairs: `Record<string, string | undefined>`
  - A function that returns headers: `() => Record<string, string | undefined>`
  - An async function that returns headers: `async () => Record<string, string | undefined>`
  - A promise that resolves to headers: `Promise<Record<string, string | undefined>>`

- **fetch** _(input: RequestInfo, init?: RequestInit) => Promise&lt;Response&gt;_

  Custom [fetch](https://developer.mozilla.org/en-US/docs/Web/API/fetch) implementation.
  Defaults to the global `fetch` function.
  You can use it as a middleware to intercept requests,
  or to provide a custom fetch implementation for e.g. testing.

## Language Models

You can create models that call the Vertex API using the provider instance.
The first argument is the model id, e.g. `gemini-1.5-pro`.

```ts
const model = vertex('gemini-1.5-pro');
```

<Note>
  If you are using [your own
  models](https://cloud.google.com/vertex-ai/docs/training-overview), the name
  of your model needs to start with `projects/`.
</Note>

Google Vertex models support also some model specific settings that are not part
of the [standard call settings](/docs/ai-sdk-core/settings). You can pass them as
an options argument:

```ts
const model = vertex('gemini-1.5-pro', {
  safetySettings: [
    { category: 'HARM_CATEGORY_UNSPECIFIED', threshold: 'BLOCK_LOW_AND_ABOVE' },
  ],
});
```

The following optional settings are available for Google Vertex models:

- **structuredOutputs** _boolean_

  Optional. Enable structured output. Default is true.

  This is useful when the JSON Schema contains elements that are
  not supported by the OpenAPI schema version that
  Google Vertex uses. You can use this to disable
  structured outputs if you need to.

  See [Troubleshooting: Schema Limitations](#troubleshooting-schema-limitations) for more details.

- **safetySettings** _Array\<\{ category: string; threshold: string \}\>_

  Optional. Safety settings for the model.

  - **category** _string_

    The category of the safety setting. Can be one of the following:

    - `HARM_CATEGORY_UNSPECIFIED`
    - `HARM_CATEGORY_HATE_SPEECH`
    - `HARM_CATEGORY_DANGEROUS_CONTENT`
    - `HARM_CATEGORY_HARASSMENT`
    - `HARM_CATEGORY_SEXUALLY_EXPLICIT`
    - `HARM_CATEGORY_CIVIC_INTEGRITY`

  - **threshold** _string_

    The threshold of the safety setting. Can be one of the following:

    - `HARM_BLOCK_THRESHOLD_UNSPECIFIED`
    - `BLOCK_LOW_AND_ABOVE`
    - `BLOCK_MEDIUM_AND_ABOVE`
    - `BLOCK_ONLY_HIGH`
    - `BLOCK_NONE`

- **useSearchGrounding** _boolean_

  Optional. When enabled, the model will [use Google search to ground the response](https://cloud.google.com/vertex-ai/generative-ai/docs/grounding/overview).

You can use Google Vertex language models to generate text with the `generateText` function:

```ts highlight="1,5"
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-edge';
import { generateText } from 'ai';

const vertex = createVertex({
  headers: async () => ({
    Authorization: `Bearer ${await generateAuthToken()}`,
  }),
});

const { text } = await generateText({
  model: vertex('gemini-1.5-pro'),
  prompt: 'Write a vegetarian lasagna recipe for 4 people.',
});
```

Google Vertex language models can also be used in the `streamText` and `streamUI` functions
(see [AI SDK Core](/docs/ai-sdk-core) and [AI SDK RSC](/docs/ai-sdk-rsc)).

### File Inputs

The Google Vertex provider supports file inputs, e.g. PDF files.

```ts
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-edge';
import { generateText } from 'ai';

const vertex = createVertex({
  headers: async () => ({
    Authorization: `Bearer ${await generateAuthToken()}`,
  }),
});

const { text } = await generateText({
  model: vertex('gemini-1.5-pro'),
  messages: [
    {
      role: 'user',
      content: [
        {
          type: 'text',
          text: 'What is an embedding model according to this document?',
        },
        {
          type: 'file',
          data: fs.readFileSync('./data/ai.pdf'),
          mimeType: 'application/pdf',
        },
      ],
    },
  ],
});
```

<Note>
  The AI SDK will automatically download URLs if you pass them as data, except
  for `gs://` URLs. You can use the Google Cloud Storage API to upload larger
  files to that location.
</Note>

See [File Parts](/docs/foundations/prompts#file-parts) for details on how to use files in prompts.

### Search Grounding

With [search grounding](https://cloud.google.com/vertex-ai/generative-ai/docs/grounding/overview),
the model has access to the latest information using Google search.
Search grounding can e.g. be used to provide answers around current events:

```ts highlight="6,13-15"
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-edge';
import { generateText } from 'ai';

const vertex = createVertex({
  headers: async () => ({
    Authorization: `Bearer ${await generateAuthToken()}`,
  }),
});
const { text, experimental_providerMetadata } = await generateText({
  model: vertex('gemini-1.5-pro', {
    useSearchGrounding: true,
  }),
  prompt:
    'List the top 5 San Francisco news from the past week.' +
    'You must include the date of each article.',
});

// access the grounding metadata
const groundingMetadata =
  experimental_providerMetadata?.vertex.groundingMetadata;
```

### Troubleshooting

#### Schema Limitations

The Google Vertex API uses a subset of the OpenAPI 3.0 schema,
which does not support features such as unions.
The errors that you get in this case look like this:

`GenerateContentRequest.generation_config.response_schema.properties[occupation].type: must be specified`

By default, structured outputs are enabled (and for tool calling they are required).
You can disable structured outputs for object generation as a workaround:

```ts highlight="3,8"
const result = await generateObject({
  model: vertex('gemini-1.5-pro', {
    structuredOutputs: false,
  }),
  schema: z.object({
    name: z.string(),
    age: z.number(),
    contact: z.union([
      z.object({
        type: z.literal('email'),
        value: z.string(),
      }),
      z.object({
        type: z.literal('phone'),
        value: z.string(),
      }),
    ]),
  }),
  prompt: 'Generate an example person for testing.',
});
```

### Model Capabilities

| Model              | Image Input         | Object Generation   | Tool Usage          | Tool Streaming      |
| ------------------ | ------------------- | ------------------- | ------------------- | ------------------- |
| `gemini-1.5-flash` | <Check size={18} /> | <Check size={18} /> | <Check size={18} /> | <Check size={18} /> |
| `gemini-1.5-pro`   | <Check size={18} /> | <Check size={18} /> | <Check size={18} /> | <Check size={18} /> |

<Note>
  The table above lists popular models. You can also pass any available provider
  model ID as a string if needed.
</Note>

## Embedding Models

You can create models that call the Google Vertex AI embeddings API using the `.textEmbeddingModel()` factory method:

```ts
const model = vertex.textEmbeddingModel('text-embedding-004');
```

Google Vertex AI embedding models support additional settings. You can pass them as an options argument:

```ts
const model = vertex.textEmbeddingModel('text-embedding-004', {
  outputDimensionality: 512, // optional, number of dimensions for the embedding
});
```

The following optional settings are available for Google Vertex AI embedding models:

- **outputDimensionality**: _number_

  Optional reduced dimension for the output embedding. If set, excessive values in the output embedding are truncated from the end.

### Model Capabilities

| Model                | Max Values Per Call | Parallel Calls      |
| -------------------- | ------------------- | ------------------- |
| `text-embedding-004` | 2048                | <Check size={18} /> |

<Note>
  The table above lists popular models. You can also pass any available provider
  model ID as a string if needed.
</Note>

## Upgrading from Pre-2.0 Versions

If you're upgrading from a version earlier than 2.0, there are several important changes to note:

- the Google Vertex provider now supports both Node.js and Edge runtimes
- there is no longer a default provider instance. You must create your own using the `createVertex` function.
- authentication is now handled through a `headers` async function that you must pass to the provider

More on these changes below.

### Authentication Changes

Authentication is now handled through a `headers` async function that you must pass to the provider. The implementation depends on your runtime environment:

#### Node.js Runtime

For Node.js environments, import the authentication helper from the dedicated sub-module:

```ts
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-google';

const vertex = createVertex({
  project: 'my-project',
  location: 'us-central1',
  headers: async () => {
    const token = await generateAuthToken({
      // The previous googleAuthOptions are now passed here
      keyFilename: 'path/to/service-account.json',
      // ... other auth options
    });
    return {
      Authorization: `Bearer ${token}`,
    };
  },
});
```

Another common way to specify the path to the service account JSON file is by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable. If you do so, you can omit the `keyFilename` option. For more, see the [Google Auth Library documentation](https://cloud.google.com/nodejs/docs/reference/google-auth-library/latest).

#### Edge Runtime

For Edge environments, use the edge-specific authentication helper:

```ts
import { createVertex } from '@ai-sdk/google-vertex';
import { generateAuthToken } from '@ai-sdk/google-vertex/auth-edge';

const vertex = createVertex({
  project: 'my-project',
  location: 'us-central1',
  headers: async () => {
    const token = await generateAuthToken();
    return {
      Authorization: `Bearer ${token}`,
    };
  },
});
```

For Edge runtime authentication, you'll need to set these environment variables from your Google Default Application Credentials JSON file:

- `GOOGLE_PRIVATE_KEY`
- `GOOGLE_PRIVATE_KEY_ID`
- `GOOGLE_CLIENT_EMAIL`

These values can be obtained from your service account JSON file in the Google Cloud Console.
